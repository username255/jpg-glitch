/**
 * almond 0.2.6 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

// MIT license

/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */

(function(){var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,u.deps&&n(u.deps,u.callback),n},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("lib/almond-0.2.6",function(){}),function(e,t){typeof define=="function"&&define.amd?define("lib/glitch-canvas",t):typeof exports=="object"?module.exports=t():e.glitch=t()}(this,function(){function v(r,i,s){if(T(r)&&N(i,"parameters","object")&&N(s,"callback","function")){u=x(i),m(e,r),m(t,r),a=y(r,u.quality),f=w(a),l=b(f);for(p=0,d=u.iterations;p<d;p++)g(f,l,u.seed,u.amount,p,u.iterations);c=new Image,c.onload=function(){n.drawImage(c,0,0),h=n.getImageData(0,0,r.width,r.height),s(h)},c.src=E(f)}}function m(e,t){e.width!==t.width&&(e.width=t.width),e.height!==t.height&&(e.height=t.height)}function g(e,t,n,r,i,s){var o=e.length-t-4,u=parseInt(o/s*i,10),a=parseInt(o/s*(i+1),10),f=a-u,l=parseInt(u+f*n,10);l>o&&(l=o);var c=Math.floor(t+l);e[c]=Math.floor(r*256)}function y(e,n){var i=typeof n=="number"&&n<1&&n>0?n:.1;r.putImageData(e,0,0);var s=t.toDataURL("image/jpeg",i);switch(s.length%4){case 3:s+="=";break;case 2:s+="==";break;case 1:s+="==="}return s}function b(e){var t=417;for(p=0,d=e.length;p<d;p++)if(e[p]===255&&e[p+1]===218){t=p+2;break}return t}function w(e){var t=[],n,r,i;for(p=23,d=e.length;p<d;p++){r=o[e.charAt(p)],n=(p-23)%4;switch(n){case 1:t.push(i<<2|r>>4);break;case 2:t.push((i&15)<<4|r>>2);break;case 3:t.push((i&3)<<6|r)}i=r}return t}function E(e){var t=["data:image/jpeg;base64,"],n,r,i;for(p=0,d=e.length;p<d;p++){r=e[p],n=p%3;switch(n){case 0:t.push(s[r>>2]);break;case 1:t.push(s[(i&3)<<4|r>>4]);break;case 2:t.push(s[(i&15)<<2|r>>6]),t.push(s[r&63])}i=r}return n===0?(t.push(s[(i&3)<<4]),t.push("==")):n===1&&(t.push(s[(i&15)<<2]),t.push("=")),t.join("")}function S(e){var t=r.createImageData(e.width,e.height);return t.data.set(e.data),t}function x(e){return{seed:(e.seed||0)/100,quality:(e.quality||0)/100,amount:(e.amount||0)/100,iterations:e.iterations||0}}function T(e){return N(e,"image_data","object")&&N(e.width,"image_data.width","number")&&N(e.height,"image_data.height","number")&&N(e.data,"image_data.data","object")&&N(e.data.length,"image_data.data.length","number")&&C(e.data.length,"image_data.data.length",k,"> 0")?!0:!1}function N(e,t,n){return typeof e===n?!0:(L(e,"typeof "+t,'"'+n+'"','"'+typeof e+'"'),!1)}function C(e,t,n,r){if(n(e)===!0)return!0;L(e,t,r,"not")}function k(e){return e>0}function L(e,t,n,r){throw new Error("glitch(): Expected "+t+" to be "+n+", but it was "+r+".")}var e=document.createElement("canvas"),t=document.createElement("canvas"),n=e.getContext("2d"),r=t.getContext("2d"),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=i.split(""),o={},u,a,f,l,c,h,p,d;return s.forEach(function(e,t){o[e]=t}),v}),define("util/canvas",[],function(){function t(t,n){t.width!==n.width&&(t.width=n.width,e=!0),t.height!==n.height&&(t.height=n.height,e=!0),e&&(t.width=n.width,t.height=n.height),e=!1}function n(e,t){t.clearRect(t,0,0,e.width,e.height)}var e=!1;return{resize:t,clear:n}}),function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),define("lib/raf",function(){}),define("src/process",["lib/glitch-canvas","util/canvas","lib/raf"],function(e,t){function h(e){f=e.signals,f["image-loaded"].add(d),f["control-updated"].add(p),f["image-data-url-requested"].add(E)}function p(e){u=S(e),m()}function d(e){o||(a=e,y(a),g(a),b(a))}function v(){o||requestAnimationFrame(m),o=!0}function m(){a?b(a):o=!1}function g(e){r.drawImage(e,0,0),l=r.getImageData(0,0,n.width,n.height)}function y(e){t.clear(n,r),t.resize(n,e),t.clear(i,s),t.resize(i,e)}function b(t){o=!0,e(l,u,w)}function w(e){s.putImageData(e,0,0),o=!1,e=null}function E(e){typeof e=="function"&&e(i.toDataURL("image/png"))}function S(e){var t={};for(var n in e)t[n]=parseInt(e[n],10);return n=null,t}var n=document.createElement("canvas"),r=n.getContext("2d"),i=document.getElementById("canvas"),s=i.getContext("2d"),o=!1,u,a,f,l,c;return{init:h}}),define("src/image",[],function(){function i(n){e=n.signals,t=new Image,e["set-new-src"].add(o),t.addEventListener("load",s,!1),o(r)}function s(){e["image-loaded"].dispatch(t),n&&e["close-intro"].dispatch(),n=!0}function o(e){t.src=e,n&&t.naturalWidth!==undefined&&t.naturalWidth!==0&&setTimeout(s,10)}var e,t,n=!1,r=document.body.getAttribute("data-defaultimage");return{init:i}}),define("src/file",[],function(){function i(r){e=r.signals,n=r.feature,n["file-api"]&&(e["load-file"].add(s),t=new FileReader,t.addEventListener("load",o,!1))}function s(e){e&&e.type&&r.indexOf(e.type)!==-1&&t.readAsDataURL(e)}function o(t){e["set-new-src"].dispatch(t.target.result)}var e,t,n,r=["image/png","image/jpg","image/jpeg"];return{init:i}}),define("src/dragdrop",[],function(){function n(n){t=n.feature,e=n.signals,t["drag-drop"]&&(document.addEventListener("drop",i,!1),document.addEventListener("dragover",r,!1),document.addEventListener("dragleave",r,!1))}function r(e){e.preventDefault()}function i(t){t.preventDefault(),t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files[0]&&(e["load-file"].dispatch(t.dataTransfer.files[0]),e["close-intro"].dispatch())}var e,t;return{init:n}}),define("src/controls",[],function(){function s(s){n=s.signals;if(s.feature["query-selector-all"]){var h=document.getElementById("controls");r=h.querySelectorAll(".control-input"),h.className+=" is-active";for(var p=0;p<r.length;p++){var d=r[p];d.addEventListener("input",o,!1),i&&d.addEventListener("change",o,!1),a(c(d.id),d.value),f(l(d.id),d.value)}t=!0,n["control-set"].add(u),n["control-updated"].dispatch(e)}}function o(e){e.target&&(e=e.target),a(c(e.id),e.value),f(l(e.id),e.value)}function u(t){var r,i={};for(var s in t)r=l(s),r.value=t[s],o(r),i[c(s)]=t[s];e=i,n["control-updated"].dispatch(e)}function a(r,i){e[r]=i,t&&n["control-updated"].dispatch(e)}function f(e,t){e.value!==t&&(e.value=t)}function l(e){var t,n=c(e),i;for(var s=0,o=r.length;s<o;s++){i=r[s].id;if(i!==e&&i.indexOf(n)!==-1){t=r[s];break}}return t}function c(e){return e.replace("-slider","").replace("-number","")}var e={},t=!1,n,r,i=document.querySelector("html").classList.contains("somewhatokie");return{init:s}}),define("src/export-button",[],function(){function f(o){e=o.signals,t=document.getElementById("export-button"),n=document.getElementById("png-button"),r=n.getAttribute("download").replace(u,""),i=r,s=r,t.addEventListener("click",l,!1),n.addEventListener("click",v,!1),e["load-file"].add(c),e["load-file"].add(p),e["control-updated"].add(h),e["control-updated"].add(p)}function l(t){t.preventDefault(),e["image-data-url-requested"].dispatch(d)}function c(e){e&&typeof e.name=="string"&&(i=e.name.replace(u,""))}function h(e){a=e||a}function p(){s=i+"-glitched-"+m(a)+o}function d(e){n.href=e,n.setAttribute("download",s),n.classList.add("is-active")}function v(){n.classList.remove("is-active")}function m(e){var t=[];for(var n in e)t.push(n[0]+""+e[n]);return t.join("-")}var e,t,n,r,i,s,o=".png",u=/(\.)(jpg|jpeg|png|gif|bmp)/ig,a;return{init:f}}),define("util/trigger-event",[],function(){function e(e,t){var n;if(e.ownerDocument)n=e.ownerDocument;else{if(e.nodeType!==9)throw new Error("Invalid node passed to fireEvent: "+e.id);n=e}if(e.fireEvent){var r=n.createEventObject();r.synthetic=!0,e.fireEvent("on"+t,r)}else if(e.dispatchEvent){var i="";switch(t){case"click":case"mousedown":case"mouseup":i="MouseEvents";break;case"focus":case"change":case"blur":case"select":i="HTMLEvents";break;default:throw"triggerEvent: Couldn’t find an event class for event "+t+"."}var r=n.createEvent(i),s=t=="change"?!1:!0;r.initEvent(t,s,!0),r.synthetic=!0,e.dispatchEvent(r)}}return e}),define("src/import-button",["util/trigger-event"],function(e){function a(e){n=e.signals,t=e.feature,t["file-api"]&&(s=new FileReader,r=document.getElementById("import-button"),i=document.getElementById("import-input"),r.addEventListener("click",f,!1),i.addEventListener("change",l,!1))}function f(t){t.preventDefault(),u||e(i,"click")}function l(e){var t=e.target.files;e.target&&e.target.files&&e.target.files[0]&&(n["load-file"].dispatch(e.target.files[0]),n["close-intro"].dispatch())}var t,n,r,i,s,o,u=!1;return{init:a}}),define("src/random-button",[],function(){function i(i){e=i.signals,i.feature["query-selector-all"]&&(t=document.querySelectorAll(".control-slider"),r=u(t),n=document.getElementById("random-button"),n.addEventListener("click",s,!1),n.classList.remove("is-hidden"))}function s(e){e.preventDefault(),o()}function o(){var t={},n;for(var i in r)n=r[i],t[i]=a(n.min,n.max);e["control-set"].dispatch(t)}function u(e){var t={},n;for(var r=0,i=e.length;r<i;r++)n=e[r],t[n.id]={min:parseInt(n.min,10),max:parseInt(n.max,10)};return t}function a(e,t){return Math.floor(Math.random()*(t-e+1))+e}var e,t,n,r={};return{init:i}}),!function(e,t,n){typeof module!="undefined"&&module.exports?module.exports=n():typeof define=="function"&&define.amd?define("lib/reqwest",n):t[e]=n()}("reqwest",this,function(){function handleReadyState(e,t,n){return function(){if(e._aborted)return n(e.request);e.request&&e.request[readyState]==4&&(e.request.onreadystatechange=noop,twoHundo.test(e.request.status)?t(e.request):n(e.request))}}function setHeaders(e,t){var n=t.headers||{},r;n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"],!t.crossOrigin&&!n[requestedWith]&&(n[requestedWith]=defaultHeaders.requestedWith),n[contentType]||(n[contentType]=t.contentType||defaultHeaders.contentType);for(r in n)n.hasOwnProperty(r)&&"setRequestHeader"in e&&e.setRequestHeader(r,n[r])}function setCredentials(e,t){typeof t.withCredentials!="undefined"&&typeof e.withCredentials!="undefined"&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var i=uniqid++,s=e.jsonpCallback||"callback",o=e.jsonpCallbackName||reqwest.getcallbackPrefix(i),u=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),a=r.match(u),f=doc.createElement("script"),l=0,c=navigator.userAgent.indexOf("MSIE 10.0")!==-1;return a?a[3]==="?"?r=r.replace(u,"$1="+o):o=a[3]:r=urlappend(r,s+"="+o),win[o]=generalCallback,f.type="text/javascript",f.src=r,f.async=!0,typeof f.onreadystatechange!="undefined"&&!c&&(f.event="onclick",f.htmlFor=f.id="_reqwest_"+i),f.onload=f.onreadystatechange=function(){if(f[readyState]&&f[readyState]!=="complete"&&f[readyState]!=="loaded"||l)return!1;f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),t(lastValue),lastValue=undefined,head.removeChild(f),l=1},head.appendChild(f),{abort:function(){f.onload=f.onreadystatechange=null,n({},"Request is aborted: timeout",{}),lastValue=undefined,head.removeChild(f),l=1}}}function getRequest(e,t){var n=this.o,r=(n.method||"GET").toUpperCase(),i=typeof n=="string"?n:n.url,s=n.processData!==!1&&n.data&&typeof n.data!="string"?reqwest.toQueryString(n.data):n.data||null,o,u=!1;return(n.type=="jsonp"||r=="GET")&&s&&(i=urlappend(i,s),s=null),n.type=="jsonp"?handleJsonp(n,e,t,i):(o=xhr(n),o.open(r,i,n.async===!1?!1:!0),setHeaders(o,n),setCredentials(o,n),win[xDomainRequest]&&o instanceof win[xDomainRequest]?(o.onload=e,o.onerror=t,o.onprogress=function(){},u=!0):o.onreadystatechange=handleReadyState(this,e,t),n.before&&n.before(o),u?setTimeout(function(){o.send(s)},200):o.send(s),o)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){var t=e.match(/\.(json|jsonp|html|xml)(\?|$)/);return t?t[1]:"js"}function init(o,fn){function complete(e){o.timeout&&clearTimeout(self.timeout),self.timeout=null;while(self._completeHandlers.length>0)self._completeHandlers.shift()(e)}function success(resp){resp=type!=="jsonp"?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);while(self._fulfillmentHandlers.length>0)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function error(e,t,n){e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=n,self._erred=!0;while(self._errorHandlers.length>0)self._errorHandlers.shift()(e,t,n);complete(e)}this.url=typeof o=="string"?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this,type=o.type||setType(this.url);fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n=e.name,r=e.tagName.toLowerCase(),i=function(e){e&&!e.disabled&&t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))},s,o,u,a;if(e.disabled||!n)return;switch(r){case"input":/reset|button|image|file/i.test(e.type)||(s=/checkbox/i.test(e.type),o=/radio/i.test(e.type),u=e.value,(!s&&!o||e.checked)&&t(n,normalize(s&&u===""?"on":u)));break;case"textarea":t(n,normalize(e.value));break;case"select":if(e.type.toLowerCase()==="select-one")i(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(a=0;e.length&&a<e.length;a++)e.options[a].selected&&i(e.options[a])}}function eachFormElement(){var e=this,t,n,r=function(t,n){var r,i,s;for(r=0;r<n.length;r++){s=t[byTag](n[r]);for(i=0;i<s.length;i++)serial(s[i],e)}};for(n=0;n<arguments.length;n++)t=arguments[n],/input|select|textarea/i.test(t.tagName)&&serial(t,e),r(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}function buildParams(e,t,n,r){var i,s,o,u=/\[\]$/;if(isArray(t))for(s=0;t&&s<t.length;s++)o=t[s],n||u.test(e)?r(e,o):buildParams(e+"["+(typeof o=="object"?s:"")+"]",o,n,r);else if(t&&t.toString()==="[object Object]")for(i in t)buildParams(e+"["+i+"]",t[i],n,r);else r(e,t)}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +(new Date),lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(e.crossOrigin===!0){var t=win[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(win[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return win[xmlHttpRequest]?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(arguments.length===0)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),e=="map"?t=serializeHash:e=="array"?t=reqwest.serializeArray:t=serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e,t){var n,r,i=t||!1,s=[],o=encodeURIComponent,u=function(e,t){t="function"==typeof t?t():t==null?"":t,s[s.length]=o(e)+"="+o(t)};if(isArray(e))for(r=0;e&&r<e.length;r++)u(e[r].name,e[r].value);else for(n in e)buildParams(n,e[n],i,u);return s.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){e=e||{};for(var t in e)globalSetupOptions[t]=e[t]},reqwest}),define("src/upload-imgur",["lib/reqwest"],function(e,t){function p(e){n=e.signals,r=document.getElementById("imgur-button"),i=document.getElementById("imgur-url-container"),s=document.getElementById("imgur-url-input"),o=document.getElementById("imgur-url-link"),u=document.getElementById("imgur-url-error"),a=document.getElementById("twitter-link"),f=document.getElementById("facebook-link"),l=document.getElementById("reddit-link"),r.addEventListener("click",d,!1),s.addEventListener("click",v,!1),n["control-updated"].add(b)}function d(e){e.preventDefault(),c||(n["image-data-url-requested"].dispatch(m),i.classList.remove("is-active","upload-failed","upload-successful"))}function v(){s.select()}function m(t){c||(r.classList.add("is-uploading"),c=!0,e({url:"https://api.imgur.com/3/image.json",method:"POST",headers:{Authorization:"Client-ID a4c24380d884932"},data:{image:t.split(",")[1],type:"base64"},type:"json",crossOrigin:!0,success:g,error:y}))}function g(e){c=!1;if(e&&e.data&&e.data.link){var t="Check out what I made with @snorpey’s glitch tool: ";t+=e.data.link,t+=" http://snorpey.github.io/jpg-glitch";var n="https://www.facebook.com/sharer/sharer.php?s=100";n+="&p[url]="+e.data.link,n+="&p[title]=Glitch!",n+="&p[images][0]="+e.data.link,n+="&p[summary]="+encodeURIComponent("Check out what I made with this glitch tool: http://snorpey.github.io/jpg-glitch"),r.classList.remove("is-uploading"),s.setAttribute("value",e.data.link),o.href=e.data.link,i.classList.add("is-active","upload-successful"),a.href="https://twitter.com/intent/tweet?text="+encodeURIComponent(t),f.href=n,l.href="https://www.reddit.com/submit?url="+encodeURIComponent(e.data.link)+"&title=Glitch!",h=!0}else y()}function y(e){c=!1,r.classList.remove("is-uploading"),i.classList.add("is-active","upload-failed")}function b(){h&&(i.classList.remove("is-active"),i.classList.remove("upload-failed"),i.classList.remove("upload-successful"),r.classList.remove("is-uploading"),h=!1)}var n,r,i,s,o,u,a,f,l,c=!1,h=!1;return{init:p}}),define("src/intro",[],function(){function s(t){e=t.signals,r.addEventListener("click",o),i.addEventListener("click",a),e["close-intro"].add(a)}function o(e){t?a():u()}function u(){r.classList.add("is-active"),n.classList.add("is-active"),n.style.top="0",t=!0}function a(){r.classList.remove("is-active"),n.classList.remove("is-active"),n.style.top=-f()+"px",t=!1}function f(){return n.clientHeight}var e,t=!0,n=document.querySelectorAll(".intro")[0],r=document.querySelectorAll(".intro-button")[0],i=n.querySelectorAll(".close")[0];return{init:s}}),function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||!1}(),define("lib/getusermedia",function(){}),define("src/cam",["lib/getusermedia"],function(){function u(r){o=r.signals;if(navigator.getUserMedia){e.classList.add("is-supported"),e.addEventListener("click",a),t=document.createElement("div"),t.classList.add("cam-wrapper");var s=document.createElement("div");s.textContent="Take Picture",s.classList.add("take-picture"),s.classList.add("button"),s.addEventListener("click",c),t.appendChild(s),n=document.createElement("video"),n.classList.add("cam"),n.addEventListener("click",c),t.appendChild(n),document.body.appendChild(t),i=document.createElement("canvas")}}function a(e){var t={video:!0};navigator.getUserMedia(t,f,l)}function f(e){var o;window.webkitURL?o=window.URL.createObjectURL(e):o=e,n.mozSrcObject!==undefined?n.mozSrcObject=o:n.src=o,r=e,n.play(),n.style.display="block",t.classList.add("is-active"),i.width=640,i.height=480,s=i.getContext("2d")}function l(){console.log("sorry, but there was an error accessing you camera...")}function c(e){s.translate(i.width,0),s.scale(-1,1),s.drawImage(n,0,0);var u=s.getImageData(0,0,i.width,i.height),a=i.toDataURL("image/png");t.classList.remove("is-active"),o["set-new-src"].dispatch(a),setTimeout(function(){r.stop()},500)}var e=document.getElementById("cam-button"),t,n,r,i,s,o;return{init:u}}),define("util/feature-test",[],function(){function t(t,n){var r=!0,i={},s=[];for(var o in e){var u=e[o].test();u||e[o].required&&(r=!1,s.push(o)),i[o]=u}r?t(i):n(s,i)}var e={canvas:{required:!0,test:function(){return!!document.createElement("canvas").getContext}},"query-selector-all":{required:!1,test:function(){return!!document.querySelectorAll}},"drag-drop":{required:!1,test:function(){return"draggable"in document.createElement("span")}},"file-api":{required:!1,test:function(){return typeof FileReader!="undefined"}}};return t}),function(e){function t(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0}function n(e,t){if(typeof e!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function r(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){r.prototype.dispatch.apply(e,arguments)}}t.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&!!this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},r.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,n,r,i){var s=this._indexOfListener(e,r),o;if(s!==-1){o=this._bindings[s];if(o.isOnce()!==n)throw new Error("You cannot add"+(n?"":"Once")+"() then add"+(n?"Once":"")+"() the same listener without removing the relationship first.")}else o=new t(this,e,n,r,i),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(e){var t=this._bindings.length;do--t;while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){var n=this._bindings.length,r;while(n--){r=this._bindings[n];if(r._listener===e&&r.context===t)return n}return-1},has:function(e,t){return this._indexOfListener(e,t)!==-1},add:function(e,t,r){return n(e,"add"),this._registerListener(e,!1,t,r)},addOnce:function(e,t,r){return n(e,"addOnce"),this._registerListener(e,!0,t,r)},remove:function(e,t){n(e,"remove");var r=this._indexOfListener(e,t);return r!==-1&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),e},removeAll:function(){var e=this._bindings.length;while(e--)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(!this.active)return;var t=Array.prototype.slice.call(arguments),n=this._bindings.length,r;this.memorize&&(this._prevParams=t);if(!n)return;r=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(r[n]&&this._shouldPropagate&&r[n].execute(t)!==!1)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var i=r;i.Signal=r,typeof define=="function"&&define.amd?define("lib/signals-1.0.0",[],function(){return i}):typeof module!="undefined"&&module.exports?module.exports=i:e.signals=i}(this),requirejs.config({baseUrl:"scripts/",waitSeconds:50,urlArgs:"bust="+(new Date).getTime()}),require(["src/process","src/image","src/file","src/dragdrop","src/controls","src/export-button","src/import-button","src/random-button","src/upload-imgur","src/intro","src/cam","util/feature-test","lib/signals-1.0.0"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){function p(c){var p={feature:c,signals:{"load-file":new h,"image-loaded":new h,"set-new-src":new h,"control-set":new h,"control-updated":new h,"close-intro":new h,"image-data-url-requested":new h}};e.init(p),r.init(p),s.init(p),i.init(p),o.init(p),u.init(p),t.init(p),n.init(p),a.init(p),f.init(p),l.init(p)}function d(e){var t=document.createElement("div"),n="sorry. it looks like your browser is missing some of the features ";n+="("+e.join(", ")+") that are required to run this ",n+="experiment.",t.innerText=n,t.className="missing-feature",document.getElementsByTagName("body")[0].appendChild(t)}c(p,d)}),define("main",function(){})})();